<!DOCTYPE html>
<html lang="en">
  <head>
    <meta 
     name='viewport' 
     content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' 
/>
    <title>This is a site for my nephew</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
    <link rel="shortcut icon" type="image" href="images/favicon.png" />
    <script type="text/javascript" src="index.js"></script>

    <script>
      $(document).ready(function() {
      //Preloader
      preloaderFadeOutTime = 500;
      function hidePreloader() {
        var preloader = $('.spinner-wrapper');
        preloader.fadeOut(preloaderFadeOutTime);
      }
      hidePreloader();
      });
    </script>

    <script> Promise.all(Array.from(document.images).filter(img => !img.complete).map(img => new Promise(resolve => { img.onload = img.onerror = resolve; }))).then(() => {
      console.log('images finished loading');});
    </script>

  </head>
  <body>

    <!--CSS Spinner-->
    <div class="spinner-wrapper">
      <div class="sk-folding-cube">
        <div class="sk-cube1 sk-cube"></div>
        <div class="sk-cube2 sk-cube"></div>
        <div class="sk-cube4 sk-cube"></div>
        <div class="sk-cube3 sk-cube"></div>
      </div>
    </div>

    <div id="background">
      <div class="container">
        <h1>Hi Flynn!</h1>
        <p><b>Choose the animal<br/> that makes this noise</b></p>
        <button style="margin-bottom: 10px" id="new-animals">New animals</button>
        <div id="audio-card-container">
          <div id="audio-container"></div>
          <div>
            <div id="animal-container"></div>
          </div>
        </div>
        <div id="answer"><h4></h4></div>
      </div>
    </div>

    <script>

      // Get urls for audio and images
      const imageURL = (animal) => `https://www.google.com/logos/fnbx/animal_sounds/${animal}.png`
      const audioURL = (randomAnimal) => `https://www.google.com/logos/fnbx/animal_sounds/${randomAnimal}.mp3`

      function buildGame() {
        const newGameBtn = document.getElementById("new-animals")
        newGameBtn.addEventListener("click", (event) => {

          const answer = document.querySelector("#answer")
            answer.innerHTML = `<h4></h4>`

          let audioCheck = document.getElementById("animal-audio")

          if(typeof(audioCheck) != 'undefined' && audioCheck != null){
            const animalButton = document.querySelectorAll(".animal-button");
            animalButton.forEach((button) =>  {
              button.remove();
            })
            removeGame("#animal-audio");
            ;
          }

          // Builds animal audio and random set of 3 animals for buttons
          let animals = shuffleAnimals(animalsArray)
          const randomAnimal = animals[Math.floor(Math.random() * animals.length)]

          animals = animals.map((animal) => {
            console.log(typeof(animal))
            return createAnimalButton(animal)
          })

          var animalAudio = createAnimalAudio(randomAnimal)
          var audioContainer = document.getElementById("audio-container")
          var animalContainer = document.getElementById("animal-container")
          audioContainer.append(animalAudio)
          animalContainer.append(...animals)


        function clickStyle(event, animal){
          if (animal === randomAnimal) {
            event.currentTarget.classList.add("success-background")
            const answer = document.querySelector("#answer")
            answer.innerHTML = `<h2>Yes it's ${prefix(randomAnimal)} ${randomAnimal}!</h2>`
          } else {
            event.currentTarget.classList.add("fail-background")
          }
        }

        prefix = (animal) => {

          if (animal[0] === "a" ||
              animal[0] === "e" ||
              animal[0] === "i" || 
              animal[0] === "o" || 
              animal[0] === "u") {
            return "an"
          } else {
            return "a"
          }
        }

        // builds the animal button html element and nested image tag
        function createAnimalButton(animal){
          let button = document.createElement("button")
          let image = document.createElement("img")
          button.className = "animal-button"
          button.addEventListener("click", (event) => clickStyle(event, animal))
          image.src = imageURL(animal)
          button.appendChild(image)
          return button
        }

        // builds audio control element for random animal from buttons
        function createAnimalAudio(randomAnimal){
          let audio = document.createElement("audio")
          audio.controls = true
          audio.id = "animal-audio"
          audio.src = audioURL(randomAnimal)
          return audio
        } 
          
        })
      }

      function clearBox(elementID) {
        document.getElementById(elementID).innerHTML = "";
      }

      function removeGame(element) {
        var elem = document.querySelector(`${element}`);
        elem.parentNode.removeChild(elem);
      }

      buildGame();

    </script>

  </body>
</htmt>
